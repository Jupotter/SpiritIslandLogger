@page "/adversary/create"
@using System.ComponentModel.DataAnnotations
@using SpiritIslandLogger.Web.Data
@inject ApplicationDbContext Db
@inject NavigationManager Navigation

<h3>Create Adversary</h3>

<EditForm Model="@adversary" OnValidSubmit="@FormSubmitted">
    <DataAnnotationsValidator/>
    <div class="form-group">
        <label for="Name">Name</label>
        <InputText @bind-Value="adversary.Name" class="form-control" id="Name"></InputText>
        <ValidationMessage For="() => adversary.Name"/>
    </div>

    <div class="form-group">
        <label for="difficulty">Difficulty</label>
        <table id="difficulty">
            <thead>
            <tr>
                <th>
                    Base
                </th>
                @for (int i = 1; i <= 6; i++)
                {
                    <th>
                        Level @i
                    </th>
                }
            </tr>
            </thead>
            <tbody>
                <tr>
                    @foreach(var id in adversary.Difficulty.Select((item, id) => id))
                    {
                        <td>
                            <InputNumber @bind-Value="adversary.Difficulty[id].Value"></InputNumber>
                        </td>
                    }
                </tr>
            </tbody>
        </table>
    </div>
    <input type="submit" value="Submit" class="btn btn-primary"/>
</EditForm>

@code {

    private class BoxedInt
    {
        [Range(1, 11)]
        public int Value { get; set; }
    }

    private class AdversaryViewModel
    {
        [Required]
        public string Name { get; set; } = "";
        public BoxedInt[] Difficulty { get; } = Enumerable.Range(1, 7).Select(i => new BoxedInt{Value = i}).ToArray();
    }

    readonly AdversaryViewModel adversary = new();

    async Task FormSubmitted()
    {
        var newAdversary = new Adversary{Name = adversary.Name, Difficulty = adversary.Difficulty.Select(v => v.Value).ToArray()};
        await Db.Adversaries.AddAsync(newAdversary);
        await Db.SaveChangesAsync();

        Navigation.NavigateTo("/adversary");
    }

}